{% extends 'reports/_layout.html' %}

{% from 'admin/_layout.html' import message as message %}

{% block content %}
	{%- if POST %}{{ "\t" }}{{ message('Payment info updated.') }}{{ "\n" }}{% endif %}
	<form action="{{ request_href ~ 'report_reg_list' }}{% if GET.vip_only == 'true' %}&amp;vip_only=true{% endif %}" method="post">
{% if dancers %}
		<input type="submit" value="Save Payment Info" class="no-print button" style="float: right; margin: -0.7em 0 1em;" />
{% endif %}
		<h3>{{ GET.vip_only == 'true' ? 'VIP Payment Confirmation' : 'Registration List' }}</h3>

{% if dancers %}
	<table class="widefat page fixed report">
		<thead>
			<tr>
				<th class="manage-column column-title" width="19%"><div>Name</div></th>
				<th class="manage-column"><div>Package</div></th>
				<th class="manage-column"><div class="ellipsis">Competitions</div></th>
				<th class="manage-column"><div>Shirts</div></th>
				<th class="manage-column" width="17%"><div>Level</div></th>
				<th class="manage-column" width="11%"><div class="ellipsis">Date Registered</div></th>
				<th class="manage-column total-cost" width="6%"><div>Total</div></th>
				<th class="manage-column paid" width="6%"><div>Paid?</div></th>
				<th class="manage-column owed" width="9%"><div>Owed</div></th>
				<th class="manage-column no-print" width="8%"><div>Method</div></th>
			</tr>
		</thead>

		<tfoot>
			<tr>
				<th class="manage-column column-title">Name</th>
				<th class="manage-column">Package</th>
				<th class="manage-column ellipsis">Competitions</th>
				<th class="manage-column">Shirts</th>
				<th class="manage-column">Level</th>
				<th class="manage-column ellipsis">Date Registered</th>
				<th class="manage-column total-cost">Total Cost</th>
				<th class="manage-column paid">Paid?</th>
				<th class="manage-column owed">Owed</th>
				<th class="manage-column no-print">Method</th>
			</tr>
		</tfoot>

		<tbody>
{% for dancer in dancers %}
			<tr {{- cycle(['', ' class="alternate"'], loop.index) | raw }}>
				<td class="column-title"><a href="{{ request_href ~ 'report_dancer' ~ '&dancer_id=' ~ dancer.id }}">{{ dancer.name_last_first }}{% if dancer.is_vip %} [VIP]{% endif %}</td>
{% for type in ['package', 'competition', 'shirt'] %}
				<td>
{%- for item in dancer.registered_items if item.type == type %}
					{%- if type != 'shirt' %}{{ item.name }}{% else %}{{ '%s (%s)' | format(item.name, item.registered_meta | capitalize) }}{% endif %}<br>
{%- endfor -%}
				</td>
{% endfor %}
				<td class="ellipsis">{{ dancer.level }}</td>
				<td class="date">{{ dancer.date_registered | date('Y-m-d, g:i A') }}</td>
				<td class="total-cost">${{ dancer.price_total }}</td>
				<td class="paid">{% do form.set_array_name('payment_confirmed') %}{{ form.input_checkbox(dancer.id, {'checked': dancer.payment_confirmed}) | raw }}</td>
				<td class="owed">{% do form.set_array_name('payment_owed') %}{{ form.input_text(dancer.id,  dancer.payment_owed, {'size': 3}) | raw }}{% do form.set_array_name(null) %}</td>
				<td class="no-print">{{ dancer.payment_method }}</td>
			</tr>
{% endfor %}
		</tbody>
	</table>
{% else %}
		<p>There are no registered {{ GET.vip_only == 'true' ? 'VIPs' : 'dancers' }} for this event.</p>
{% endif %}
	</form>
{% endblock content %}
